# AVA - Portal

O AVA-Portal √© um middleware integrador entre SUAP e Moodle, al√©m disso, tamb√©m tem um dashboard com todos os cursos e inscri√ß√µes que integrou, desta forma cada usu√°rio tem acesso aos cursos/di√°rios em que est√° inscrito sem precisar procurar em v√°rios Moodles.

Neste projeto, al√©m do AVA-Portal, foi colocado um Fake SUAP, para emular o funcionado da integra√ß√£od o SUAP ou outro sistema acad√™mico, e um par de Moodles (ZL e Presencial), para emular o cen√°rio de ter mais um Moodle a integrar.

> Neste projeto usamos o [Docker](https://docs.docker.com/engine/install/) e o [Docker Compose Plugin](https://docs.docker.com/compose/install/compose-plugin/#:~:text=%20Install%20the%20plugin%20manually%20%F0%9F%94%97%20%201,of%20Compose%20you%20want%20to%20use.%20More%20) (n√£o o [docker-compose](https://docs.docker.com/compose/install/) üòé). O setup foi todo testado usando o Linux e Mac OS.

> Os containeres ter√£o o prefixo `ism-`, que √© um acr√¥nimo para "Integrador Suap Moodle".

## Como funciona

**Como desenvolvedor** - no `local_settings.py` do SUAP configure as vari√°veis (`MOODLE_SYNC_URL` e `MOODLE_SYNC_TOKEN`), no AVA-Portal configure o mesmo token que voc√™ configurou no SUAP. Para cada  Moodle a ser integrado instale o plugin `auth_suap` e cadastre no AVA-Portal como um "Ambiente". 

**Como usu√°rio** - no SUAP, o secret√°rio acad√™mico autoriza cada di√°rio a ser integrado ao Moodle, na p√°gina do di√°rio no SUAP o professor clica em "Sincronizar" e a m√°gica se faz, ou seja, o SUAP envia para o AVA-Portal que, com base na sigla do campus, decide para qual Moodle encaminhar a requisi√ß√£o de integra√ß√£o, o Moodle cadastra/atualiza as categorias (Campus, Di√°rio, Semestre, Turma), o curso, os p√≥los como grupos do curso e os professores e alunos, ent√£o inscreve os professores (Formador e Tutor) e os alunos, por fim, arrola os alunos nos grupos de seus respectivos p√≥los.

As vari√°veis de ambiente no SUAP t√™m as seguintes defini√ß√µes:
- `MOODLE_SYNC_URL` - URL do AVA-Portal
- `MOODLE_SYNC_TOKEN` - o token deve ser o mesmo que voc√™ vai configurar ao cadastrar o SUAP no AVA-Portal, √© usada para autentica√ß√£o do SUAP, guarde segredo desta chave.

## Como iniciar o desenvolvimento

Este docker-compose assume que voc√™ n√£o tenha aplica√ß√µes rodando na porta 80, ou seja, pare o servi√ßo que est√° na porta 80 ou fa√ßa as configura√ß√µes necess√°rias voc√™s mesmo. O script `_/deploy` j√° cria automaticamente uma entrada no /etc/hosts, caso n√£o exista, que aponta para localhost. Isso √© necess√°rio para simplificar o cen√°rio de desenvolvimento local.

```bash
mkdir ava
cd ava


# Baixe o projeto
git clone git@github.com:cte-zl-ifrn/portal__ava.git portal__ava 

cd portal__ava

# Baixa as dependencias, instala o sistema, um suap fake e 1 moodle para teste
_/deploy


# Se voc√™ usa o VSCode
code portal__ava.code-workspace

```

> O **Portal** estar√° dispon√≠vel em http://ava/painel, o primeiro usu√°rio a acessar ser√° declarado como superusu√°rio e poder√° fazer tudo no sistema.

> O **Moodle** estar√° dispon√≠vel em http://ava/, o usu√°rio/senha do administrador ser√£o admin/admin.

Caso voc√™ deseje fazer debug da AVA-Portal, tente:

```bash
_/portal/down
_/portal/debug
```

## oAuth2 do SUAP

- √â obrigat√≥rio ao menos um dos escopos `identificacao` ou `email`, os quais retornam os atributos:
  - `identificacao` - NUM√âRICO - **√© o IFid do usu√°rio**, no caso: matr√≠cula para alunos ou servidores e CPF para demais colaboradores
  - `nome_social` - ALFANUM√âRICO - **nome social**, este √© o informado pelo indiv√≠duo, n√£o se trata de apelido, mas sim de nome social, conforme legisla√ß√£o
  - `nome_usual` - ALFANUM√âRICO - **nome usual**, escolhido pelo indiv√≠duo na interface do SUAP
  - `nome_registro` - ALFANUM√âRICO - **nome civil**, este √© conforme est√° no registro civil do indiv√≠duo
  - `nome` - ALFANUM√âRICO - **nome completo**, para compatibilidade com APIs que n√£o sabem tratar nome e sobrenome separados
  - `primeiro_nome` - ALFANUM√âRICO - **primeiro nome**, para compatibilidade com APIs que n√£o sabem tratar nome e sobrenome juntos
  - `ultimo_nome` - ALFANUM√âRICO - **√∫ltimo nome**, para compatibilidade com APIs que n√£o sabem tratar nome e sobrenome juntos
  - `campus` - ALFANUM√âRICO - **sigla do campus** do aluno ou servidor, caso exista, n√£o se aplica aos demais colaboradores
  - `email_preferencial` - EMAIL - **email preferencial** para comunica√ß√£o, caso exista, para servidores √© o mesmo que o `email`, para alunos e demais colaboradores `email_secundario`, salvo se a institui√ß√£o tiver criado um mecanismo que permita ao usu√°rio escolher qual √© seu email preferencial.
  - `email` - EMAIL - **email do servidor**, caso exista, apenas para servidores
  - `email_secundario` - EMAIL - **email pessoal**, caso exista, o mesmo usado para recupera√ß√£o de senha, para todos
  - `email_google_classroom` - EMAIL - **email do Google Suite**, caso exista, apenas para alunos e servidores
  - `email_academico` - EMAIL - **email da Microsoft 365**, caso exista, apenas para alunos e servidores
  - `foto` - URL - **URL da foto no SUAP**, assim poder√° ser usada a mesma foto em todos os ambientes
- J√° o escopo `documentos_pessoais` retorna os atributos:
  - `cpf` - NUM√âRICO - **CPF** do indiv√≠duo, √∫til para os casos de integra√ß√£o com gov.br ou para informar que possui outras contas no sistema. Poder√° ser necess√°rio novo login para trocar de conta.
  - `data_de_nascimento` - DATA - **data de nascimento**, ajuda a identificar indiv√≠duos menos de idade, entre outros
  - `sexo` - ALFANUM√âRICO - **sexo**
  - No futuro poder√° retornar dados de **necessidades especiais**, assim os sistemas j√° adaptar√£o as interfaces a estas necessidades.


## Screenshots

O design ficar√° como os designs [web](https://xd.adobe.com/view/00dc014e-8919-47ad-ab16-74ac81ca0c2a-558f/) e [mobile](https://xd.adobe.com/view/28b2f455-b115-4363-954f-77b5bcf1dba1-7de1/).

### v4 - Melhorias na UX

#### Desktop
![screenshot](docs/images/screenshot.v4.png)

#### Mobile
![screenshot](docs/images/screenshot.mobile.v4.png)

### v3 - Uso comum por aluno, tutor e professor

#### Desktop
![screenshot](docs/images/screenshot.v3.jpg)

#### Mobile
![screenshot](docs/images/screenshot.mobile.v3.png)

### v2 - Hiper focado no aluno

#### Desktop
![screenshot](screenshot.v2.png)

### v1 - Esfor√ßo urgente, sem projeto de UX

#### Desktop
![screenshot](screenshot.v1.png)

## Plugins previstos

1. suap sync (local)
   1. importar as inscri√ß√µes (alunos e professores) dos di√°rios
   2. exportar as presen√ßas dos alunos
   3. exportar as notas dos alunos
2. suap attendances (block)
   1. configurar o modelo de c√°lculo de presen√ßas
   2. permitir que os professores visualizem as presen√ßas
   3. permitir que os alunos visualizem as presen√ßas
3. suap auth (auth)
   1. aut√™nticar usando o oauth do SUAP
   2. auto inscrever os alunos ao fazer login


## Tipo de commits

- `feat:` novas funcionalidades.
- `fix:` corre√ß√£o de bugs.
- `refactor:` refatora√ß√£o ou performances (sem impacto em l√≥gica).
- `style:` estilo ou formata√ß√£o de c√≥digo (sem impacto em l√≥gica).
- `test:` testes.
- `doc:` documenta√ß√£o no c√≥digo ou do reposit√≥rio.
- `env:` CI/CD ou settings.
- `build:` build ou depend√™ncias.

